<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Story</title>
    <!-- <link href="/dist/example/stories/IndraV0.stories.css" rel="stylesheet"> -->
  </head>
  <body>
    <div id="story-root"></div>
    <script type="module">
      // Get the story path from the URL
      const urlParams = new URLSearchParams(window.location.search);
      const storyPath = urlParams.get("story");
      console.log("Loading story in iframe:", storyPath);

      if (storyPath) {
        const cssStoryPath = storyPath.replace(/\.(tsx|jsx|ts|js)$/, ".css");
        const cssPath = `/dist/${cssStoryPath}`;
        console.log("CSS import path in iframe:", cssPath);

        // Create and append the CSS link
        const link = document.createElement("link");
        link.rel = "stylesheet";
        link.href = cssPath;
        document.head.appendChild(link);

        // Convert .tsx to .js since that's what esbuild outputs
        const jsStoryPath = storyPath.replace(/\.(tsx|jsx|ts|js)$/, ".js");
        const fullPath = `/dist/${jsStoryPath}`;
        console.log("Full import path in iframe:", fullPath);

        // Add a timestamp to bust cache
        const timestamp = Date.now();
        const importPath = `${fullPath}?t=${timestamp}`;

        import(importPath).catch((error) => {
          console.error("Error loading story module:", error);
          document.getElementById("story-root").innerHTML =
            '<div style="padding: 20px; color: red;">Error loading story: ' +
            error.message +
            "</div>";
        });
      } else {
        console.log("No story path provided in iframe");
        document.getElementById("story-root").innerHTML =
          '<div style="padding: 20px;">No story selected</div>';
      }
    </script>
  </body>
</html>
